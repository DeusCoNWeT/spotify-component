<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="../paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../paper-toolbar/paper-toolbar.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../paper-fab/paper-fab.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-expansion-panel/paper-expansion-panel.html">
<link rel="import" href="../iron-collapse/iron-collapse.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Work+Sans:100" rel="stylesheet">

<dom-module id="spotify-component">
  <template>
    <style is="custom-style" include="iron-flex iron-flex-alignment">
       :host {

        display: block;
        margin: 0 auto;
        width: 400px;
        height: 400px;
        border-radius: 10px;
        background: #333;
        position: absolute;
        overflow-y: scroll;
        font-family: "Lato", "Lucida Grande", "Lucida Sans Unicode", Tahoma, Sans-Serif !important;
      }
      #tool{
        background-color: #222321;
        color: #222321;
        height: 70px;
        padding: 3px 10px; 
        
      }
      #logo{
        
        width: 100px;
        height: 30px;
      }
      p {
        margin: 0;
      }

      span {
        color: #eee;
      }

      #cabecera {
        width: 100%;
        padding: 12px 2px;
        color: #eee;
      }

      .imagenes {
        width: 80px;
        height: 80px;
      }

      #nombreLista {
        font-size: 24px;
        color: white;
      }

      #musica {
        border-top: 1px solid grey;
        height: 42px;
        display: flex;
        flex-flow: row wrap;
        align-items: center;
        padding: 0 8px;
        color: #eee;
        font-size: 12px;
        margin-left: 12px;
        margin-right: 12px;
      }
      #headmusica {
        margin: 10px 0;
      }
      #headmusica>p {
        width: 50%;
        font-weight: bold;
        font-family: 'Work Sans', sans-serif;       
        color: #eee;
        text-align: center;   
      }

      #musica>a,
      #musica>p {
        width: 50%;
        font-family: 'Roboto', sans-serif;
        padding: 0 5px;
        box-sizing: border-box;
      }

      .playlist {
        margin-left: 10px;
        color: #aaaaaa;
        font-size: 11px;
        letter-spacing: 1px;
      }
      #playtit{
        text-transform: uppercase;
      }
      #owner{
        font-weight: bolder;
      }

      a {
        text-transform: none;
        color: inherit;
        text-decoration: none;
      }

      a:hover, a:hover > span {
        color: #2ebd59;
      }

      #artista,
      #album,
      #track {
        white-space: nowrap;
        overflow: hidden;

        overflow-wrap: break-word;
        text-overflow: ellipsis;
      }
      .styled {

        --paper-expansion-panel-header: {
          color: #eee;
          font-size: 12px;
        }
      }
    </style>

    <paper-toolbar class="toolbar" id='tool'>
      <img id="logo" sizing="cover" preload src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Spotify_logo_with_text.svg/2000px-Spotify_logo_with_text.svg.png"></img>
    </paper-toolbar>

    <template is="dom-repeat" items="{{res}}" class='repeat'>
      <paper-expansion-panel class="styled" summary="Created by: {{item.owner.id}}">
        <div slot="header" id='cabecera'>
          <div class='horizontal layout'>
            <a href="{{item.external_urls.spotify}}" target='_blank'>
              <img class='imagenes' sizing="cover" preload src="{{item.images.1.url}}" id="preview"></img>
            </a>
            <div class='playlist flex vertical layout'>
              <p id='playtit'>p l a y l i s t</p>
             
              <p id='nombreLista'>{{item.name}}</p>
              
              <div class='horizontal layout'>
                  <span>Created by:</span>
                  <a href="{{item.owner.external_urls.spotify}}" target='_blank'>
                    <span id='owner'>{{item.owner.id}}</span>
                  </a>
              </div>
            </div>

          </div>

        </div>

        <div>
          <iron-ajax auto id="cons" url="{{item.tracks.href}}" headers="{{headers}}" handle-as="json" on-response="respuestaPistas"></iron-ajax>
        </div>
        <template is="dom-if" if='{{item.infoPista}}'>
          
            <div id='headmusica' class='horizontal layout flex'>
              <p id='s'> Song</p>
              <p id='a'>Artist</p>
              <!-- <p id='al'>Album</p> -->
            </div>
            <template is='dom-repeat' items="{{item.infoPista}}">
              <div id='musica' class='horizontal layout flex'>
                <a href="{{item.track.external_urls.spotify}}" target='_blank'>
                  <p id='track'> {{item.track.name}}</p>
                </a>

                <p id='artista'>{{item.track.artists.0.name}}</p>
                <!-- <p id='album'>{{item.track.album.name}}</p> -->
              </div>
         

          </template>
        </template>
      </paper-expansion-panel>
    </template>

    <iron-ajax auto id="cons" url="https://api.spotify.com/v1/me/playlists?limit=20&after=0aV6DOiouImYTqrR5YlIqx" headers="{{headers}}"
      handle-as="json" on-response="respuestaSPFY"></iron-ajax>



  </template>
  <script>
    Polymer({
      is: 'spotify-component',
      properties: {
        token: String,
        nombre: String,
        due√±o: String,
        res: {
          value: function () { return []; },
          type: Array
        },
        headers: {
          type: Object,
          computed: '_getHeaders(token)'
        }
      },
      _getHeaders: function (token) {
        return { Authorization: 'Bearer ' + this.token };
      },
      respuestaSPFY: function (evt) {
        console.log(evt.detail.response);
        var response = evt.detail.response;
        this.set('res', []);
        var items = response.items;
        for (var i = 0; i < items.length; i++) {
          this.set('res', response.items);
          console.log(items[i].nombre);
        }
      },
      respuestaPistas: function (evt) {
        var response = evt.detail.response;
        console.log(response);
        this.set('res.' + evt.model.index + ".infoPista", response.items);
      },

    });
  </script>
</dom-module>